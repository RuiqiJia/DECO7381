{% extends 'main.html' %} {% load static %} {% block content %}
<div>
  <img src="{{request.user.avatar.url}}" alt="avatar" />
</div>
<div>
  <h1>{{user.username}}</h1>

  <p>{{user.email}}</p>
  {% if request.user == user %}
  <a class="btn btn-primary" href="{% url 'updateProfile' %}">Edit Profile</a>

  {% else %}
  <a class="btn btn-primary" href="{% url 'send_request' user.id %}"
    >Add friend</a
  >
  {% endif %}
</div>

<div class="">
  <div class="">
    {% if request.user.is_authenticated %}
    <div class="">
      <!-- send to auth user -->
      {% if request_sent == 0 %}
      <div class="">
        <div class="">
          <span class="">Accept</span>
          <span
            id="id_cancel_{{id}}"
            class="decline-friend-request material-icons p-1"
            onclick='triggerDeclineFriendRequest("{{pending_friend_request_id}}")'
            >cancel</span
          >
          <span
            id="id_confirm_{{id}}"
            class="confirm-friend-request material-icons p-1"
            onclick='triggerAcceptFriendRequest("{{pending_request}}")'
            >check</span
          >
        </div>
      </div>
      {% endif %}

      <div class="">
        <!-- Cancel Friend Request / Send Friend Request / Remove Friend -->
        {% if is_friend == False and is_self == False %}
        <!--  sent to others -->
        {% if friend_request == 1 %}
        <div class="">
          <button class="btn btn-danger" id="cancel_request_btn">
            Cancel Request
          </button>
        </div>
        {% endif %} {% endif %} {% if is_friend %}
        <div class="">
          <a
            href="{% url 'requests_page' user.id %}"
            class="btn btn-secondary"
            type="button"
            >Friends</a
          >
        </div>
        {% endif %}

        <!-- Friend list link -->
        <div class="">
          <a href="{% url 'requests_page' user.id %}">
            <div class="">
              <span class="material-icons friends-icon">contact_page</span
              ><span class="">Friends ({{friends|length}})</span>
            </div>
          </a>
        </div>
      </div>

      {% if friend_requests %}
      <div class="">
        <!-- Friend requests -->
        <div class="">
          <a href="{% url 'friend-requests' user_id=id %}">
            <div class="">
              <span class="material-icons person-add-icon">person_add</span
              ><span class="friend-text"
                >Friend Requests ({{friend_requests|length}})</span
              >
            </div>
          </a>
        </div>
      </div>
      {% endif %} {% if is_friend %}
      <div
        class="btn btn-primary"
        onclick="createOrReturnPrivateChat('{{id}}')"
      >
        <span class="material-icons m-auto"> message </span>
        <span class="message-btn">Message</span>
      </div>
      {% endif %}
    </div>
    {% endif %}
  </div>
</div>

<script type="text/javascript">
  // function sendRequest(id, reloader) {
  //   context = {
  //     csrfmiddlewaretoken: "{{ csrf_token }}",
  //     receiver_id: id,
  //   };
  //   $.ajax({
  //     url: "",
  //     type: "POST",
  //     dataType: "json",
  //     timeout: 5000,
  //     data: context,
  //     success: function (data) {
  //       if (data["response"] == "Friend request has been sent successfully") {
  //         console.log("123");
  //       } else if (data["response"] != null) {
  //         alert(data["response"]);
  //       }
  //     },
  //     error: function (data) {
  //       alert("Something went wrong");
  //     },
  //     complete: function () {
  //       updateFunction(data);
  //     },
  //   });
  // }

  // var sendBtn = document.getElementById("send_request_btn");
  // if (sendBtn != null) {
  //   sendBtn.addEventListener("click", function () {
  //     console.log("here1");
  //     sendRequest("{{id}}", location.reload());
  //     console.log("here");
  //   });
  // }
</script>

{% endblock %}
